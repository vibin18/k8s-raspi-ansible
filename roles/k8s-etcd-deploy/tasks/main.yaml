- name: "Create etcd data directory || etcd deploy."
  file: 
    path: "/opt/k8s/etcd/data"
    owner: "root"
    group: "root"
    mode: 0750 
    state: directory
    recurse: yes


- name: Generating systemd for etcd daemon || etcd deploy.
  vars:
    servers: "{{ groups['k8s_masters'] }}"
    etcd:
      version: v3.0.0
      token: my-etcd-token
      clusterstate: new
      datapath: '/opt/k8s/etcd/data'
      image: 'quay.io/coreos/etcd'
  template:
    src: "{{ role_path }}/files/etcd-systemd.j2"
    dest: "/etc/systemd/system/etcd.service"
    owner: root
    group: root

  with_items: servers

- name: Reloading systemd || etcd deploy.
  systemd:
    daemon_reload: yes