- name: Generating systemd for etcd daemon.
  vars:
    servers: "{{ groups['k8s_masters'] }}"
    etcd:
      version: v3.0.0
      token: my-etcd-token
      clusterstate: new
      datapath: 'opt/k8s/etcd/data'
      image: 'quay.io/coreos/etcd'
  template:
    src: "{{ role_path }}/files/etcd-systemd.j2"
    dest: "/etc/systemd/system/etcd.service"
    owner: root
    group: root

  with_items: servers

- name: Reloading systemd
  systemd:
    daemon_reload: yes